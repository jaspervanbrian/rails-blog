<% @title = "Editing " + @post.title %>

<div class="container">
	<%= form_with scope: :post, model: @post, local: true do |p| %>
		<div class="row">
			<div class="col-12">
				<div class="list-group-item list-group-item-action flex-column align-items-start">
					<div class="d-flex w-100 justify-content-between">
						<%= render partial: "partials/show-post-profile", locals: {post_created_at: @post.created_at, user: @post.user} %>
						<div>
							<p>
								<small class="text-muted"><%= @post.created_at === @post.updated_at ? "" : "(Last update: " + @post.updated_at.strftime("%B %d, %Y | %A, %l:%M %p") + ")" %></small>
							</p>
							<% if logged_in? %>
								<% if @current_user.id === @post.user_id %>
								<div class="float-right">
									<%= p.button type: "submit", class: "btn btn-success" do %>
										<%= icon("fas", "check") %>
									<% end %>
									<%= link_to @post, class: "btn btn-secondary" do %>
										<%= icon("fas", "times") %>
									<% end %>
								</div>
								<% end %>
							<% end %>
						</div>
					</div>
					<hr class="mt-4 mb-4">
					<p class="mb-1">
						<%= p.text_area :body, rows: 10, class: "form-control #{ @post.errors.include?(:body) ? 'is-invalid' : ''}", placeholder: "Say something...", required: true %>
						<% if @post.errors.include?(:body) %>
							<div class="invalid-feedback">
								<%= @post.errors[:body].join(", ").capitalize %>
							</div>
						<% end %>
					</p>
					<div class="form-group">
						<small class="text-muted">Add photos</small>
						<div class="custom-file">
							<%= p.file_field :images, multiple: true, class: "custom-file-input #{ @post.errors.include?(:images) ? 'is-invalid' : '' }" %>
							<%= p.label :images, class: "custom-file-label" do %>
								No photo(s) selected.
							<% end %>
							<% if @post.errors.include?(:images) %>
								<div class="invalid-feedback">
									<%= @post.errors[:images].join(", ").capitalize %>
								</div>
							<% end %>
						</div>
					</div>
					<% if @images.present? %>
						<div class="row my-3 d-flex justify-content-around">
							<% @images.each do |image| %>
								<div class="img-container align-self-end text-center">
									<%= image_tag image, class: "img-thumbnail m-3", size: "200x200" %>
									<%= link_to delete_image_attachment_post_path(image), class: "btn btn-outline-danger", method: :delete, data: {confirm: "Are you sure you want to delete this image? (It can't be undone.)"} do %>
										<%= icon("fas", "times") %>
									<% end %>
								</div>
							<% end %>
						</div>
					<% end %>
				</div>
			</div>
		</div>
	<% end %>
</div>