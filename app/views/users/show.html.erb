<% @title = "All Posts" %>

<div class="container">
	<div class="row">
		<div class="col-4">
			<div class="twPc-div">
				<a class="twPc-bg twPc-block"></a>

				<div>
					<a title="<%= @user.full_name %>" href="#" class="twPc-avatarLink">
						<img alt="<%= @user.full_name %>" src="https://mertskaplan.com/wp-content/plugins/msk-twprofilecard/img/mertskaplan.jpg" class="twPc-avatarImg">
					</a>

					<div class="twPc-divUser">
						<div class="twPc-divName">
							<%= link_to @user.full_name, user_path(@user) %>
						</div>
						<span class="text-danger">
							<%= @user.email %>
						</span>
					</div>

					<div class="twPc-divStats">
						<ul class="twPc-Arrange">
							<li class="twPc-ArrangeSizeFit">
								<a href="https://twitter.com/mertskaplan" title="9.840 Tweet">
									<span class="twPc-StatLabel twPc-block">Posts</span>
									<span class="twPc-StatValue"><%= @posts.length %></span>
								</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="col-8">
			<!-- Nav tabs -->
			<ul class="nav nav-tabs">
				<li class="nav-item">
					<a class="nav-link active" data-toggle="tab" href="#posts">Posts</a>
				</li>
				<% if logged_in? %>
					<% if @current_user.id == @user.id %>
						<li class="nav-item">
							<a class="nav-link" data-toggle="tab" href="#create">Create a post</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" data-toggle="tab" href="#editProfile">Edit Profile</a>
						</li>
					<% end %>
				<% end %>
			</ul>

			<!-- Tab panes -->
			<div class="tab-content">
				<div class="tab-pane container active" id="posts">
					<%= render partial: "partials/posts", locals: {posts: @posts} %>
				</div>
				<div class="tab-pane container fade" id="create">
					<%= form_with scope: :post, model: @post, class: 'form-horizontal needs-validation', html: {novalidate: true}, local: true do |form| %>
						<div class="form-group">
							<%= form.text_field :title, :class => "form-control #{ @post.errors.include?(:title) ? 'is-invalid' : ''}", :placeholder => 'Title of your post', maxlength: 50 %>
							<% if @post.errors.include?(:title) %>
								<div class="invalid-feedback">
									<%= @post.errors[:title].join(", ").capitalize %>
								</div>
							<% end %>
						</div>
						<div class="form-group">
							<%= form.text_area :body, :class => "form-control #{ @post.errors.include?(:body) ? 'is-invalid' : ''}", :placeholder => 'Say something here!', :rows => 9 %>
							<% if @post.errors.include?(:body) %>
								<div class="invalid-feedback">
									<%= @post.errors[:body].join(", ").capitalize %>
								</div>
							<% end %>
						</div>
						<hr>
						<div class="form-group">
							<%= form.submit "Post", :class => 'btn btn-danger' %>
						</div>
					<% end %>
				</div>
				<div class="tab-pane container fade" id="editProfile">
					<%= form_with scope: :user, model: @user, class: 'form-horizontal needs-validation', html: {novalidate: true}, local: true do |form| %>
						<div class="form-group">
							<div class="row">
								<div class="col-6">
									<%= form.label :first_name %>
									<%= form.text_field :first_name, class: "form-control #{ @user.errors.include?(:first_name) ? 'is-invalid' : '' }", placeholder: "First name", required: true, autofocus: true %>
									<% if @user.errors.include?(:first_name) %>
										<div class="invalid-feedback">
											<%= @user.errors[:first_name].join(", ").capitalize %>
										</div>
									<% end %>
								</div>
								<div class="col-6">
									<%= form.label :last_name %>
									<%= form.text_field :last_name, class: "form-control #{ @user.errors.include?(:last_name) ? 'is-invalid' : '' }", placeholder: "Last name", required: true %>
									<% if @user.errors.include?(:last_name) %>
										<div class="invalid-feedback">
											<%= @user.errors[:last_name].join(", ").capitalize %>
										</div>
									<% end %>
								</div>
							</div>
						</div>
						<div class="form-group">
							<%= form.label :email %>
							<%= form.email_field :email, class: "form-control #{ @user.errors.include?(:email) ? 'is-invalid' : '' }", placeholder: "Email address", id: "inputEmail", required: true %>
							<% if @user.errors.include?(:email) %>
								<div class="invalid-feedback">
									<%= @user.errors[:email].join(", ").capitalize %>
								</div>
							<% end %>
						</div>
						<hr>
						<div class="form-group">
							<%= form.label "Enter password to confirm" %>
							<%= form.password_field :password, class: "form-control #{ flash[:error_user_details].present? ? 'is-invalid' : ''}", placeholder: "Your password", id: "inputPassword", required: true %>
							<% if flash[:error_user_details].present? %>
								<div class="invalid-feedback">
									<%= flash[:error] %>
								</div>
							<% end %>
						</div>
						<div class="form-group">
							<%= form.submit "Update profile", class: "btn btn-danger" %>
						</div>
					<% end %>
				</div>
			</div>
		</div>
	</div>
</div>

<% if flash[:error_user_details].present? %>
	<script>
		$(document).ready(function() {
			$("#editProfile").tab('show');
		});
	</script>
<% end %>